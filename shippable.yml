language: node_js

node_js:
  - 7.10.1

branches:
  only:
    - master-ci-shippable

env:
  global:
  - TEST_RESULTS_DIR=$SHIPPABLE_REPO_DIR/shippable/testresults
  - CODE_COVERAGE_DIR=$SHIPPABLE_REPO_DIR/shippable/codecoverage
  - TESTS_LOC_DIR=$SHIPPABLE_REPO_DIR/test
  - MOD_LOC=$SHIPPABLE_REPO_DIR/node_modules/.bin/
  - secure: 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
  
build:
  cache: true
  cache_dir_list:
    - $SHIPPABLE_BUILD_DIR/node_modules
  ci:
    - shippable_retry npm install
    - mkdir -p $TEST_RESULTS_DIR && mkdir -p $CODE_COVERAGE_DIR
    - pushd $TESTS_LOC_DIR
    - $MOD_LOC/mocha --recursive "$TESTS_LOC_DIR/**/*.spec.js" -R mocha-junit-reporter --reporter-options mochaFile=$TEST_RESULTS_DIR/testresults.xml
    - $MOD_LOC/istanbul --include-all-sources cover $MOD_LOC/_mocha -- --recursive "$TESTS_LOC_DIR/**/*.spec.js" --ui=bdd -R xunit-file
    - $MOD_LOC/istanbul report cobertura --dir $CODE_COVERAGE_DIR
    - popd
  post_ci:
    - if [ "$BRANCH" == "master-ci-shippable" ]; then ./.shippable/post_CI_processing.sh; fi
